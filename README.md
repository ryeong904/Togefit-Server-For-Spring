# Togefit 서버 코드 Spring으로 재구축

### 재구축하는 이유?

Spring Boot를 공부함과 동시에 기존에 작성했던 프로젝트를 다시 작성해보면서 보이는 문제점들을 해결하기 위해

### 목표

최대한 이전 프로젝트 때 사용했던 API와 비슷하게 만들기. 단, 수정이 필요해 보이는 부분은 더 나은 방식으로 수정한다.

### 진행하면서 얻은 부분

- Spring Boot 사용법
- DI
- Junit 테스트 코드 작성법
- 인터셉터
- 스프링 에러 핸들링
- JPA

### 마주한 문제 & 해결 방법
**1. middleware는 인터셉터로 해결**
- express.js처럼 내가 원하는 곳에 골라넣을 수는 없어서 불편했음.
- 인터셉터에서 HTTP 메소드가 무엇인지 검사하고, uri를 따로 체크해서 문제를 해결함.

**2. 에러 핸들러**

  - 기존에 에러가 나면 다음과 같은 형태로 반환이 되었음
    
    ```jsx
    {result: "error", reason: "중복되는 사용자 입니다."}
    ```

  - 이 형태를 맞추기 위해서 ResponseEntity를 사용함. 에러코드와 메시지를 넣을 수 있는 클래스를 따로 작성.
  - Message 클래스는 result와 reason을 가지는 객체이며, `RuntimeException` 으로 구현한 나의 `CustomException` 을 사용하여 에러가 발생시 Message, header, 상태 코드를 반환하는 형태로 구현함.

**3. mongoDB에서 손쉽게 저장하던 array형식 해결하기**

  - 여기서 mongoDB와 mySQL, 즉 NoSQL과 SQL이 차이점을 느낄 수 있었음.
  - mongoDB는 형식을 따로 지정해주지 않아도 되고, 바로 데이터를 넣을 수 있었음.
  - mySQL은 array 형태를 제공하지 않을 뿐더러, JSON을 사용해 문자열로 넣을 수 있는 방법이 있긴 하지만 권장하지 않는 방법임. 왜냐하면 SQL 자체가 관계를 표현하는데 특화되어 있기 때문.
  - 따라서 테이블 3개를 만들어 join을 사용하여 문제를 해결함.

**4. 페이지네이션**

  - Java Spring에서 제공하는 **Pageable**을 사용하여 문제를 해결할 수 있었음.
  
### 구현 내용
1. User
    - [x]  회원가입
    - [x]  로그인
    - [x]  로그아웃
    - [x]  정보 수정
    - [x]  탈퇴
    - [x]  유저 정보 가져오기

1. Food
    - [x]  음식 등록
    - [x]  음식 삭제
    - [x]  음식 정보 수정
    - [x]  음식 리스트 가져오기
    - [x]  음식 검색

1. ExerciseList
    - [x]  운동 추가
    - [x]  전체 운동 리스트 가져오기
    - [x]  운동 검색
    - [x]  운동 삭제
    
2. Routine
    - [x]  루틴 추가
    - [x]  루틴 가져오기
    - [x]  루틴 삭제
    - [x]  루틴 수정
    - [x]  루틴 검색

1. Meal
    - [x]  식단 글
        - [x]  식단 글 등록
        - [x]  식단 글 삭제
        - [x]  식단 글 가져오기
        - [x]  식단 리스트 가져오기 (전체)
        - [x]  식단 리스트 가져오기 (유저별)
    - [x]  식사 1개 당
        - [x]  식사 추가
        - [x]  식사 수정
        - [x]  식사 삭제

1. Post
    - [x]  게시글 추가
    - [x]  게시글 삭제
    - [x]  게시글 수정
    - [x]  게시글 가져오기
        - [x]  전체
        - [x]  유저+월
        - [x]  게시글 ID
        - [x]  무한스크롤
    - [x]  댓글
        - [x]  등록
        - [x]  삭제
        - [x]  수정
    - [x]  잔디
    - [x]  좋아요
        - [x]  누르기/취소하기
        - [x]  눌렀는지 확인
